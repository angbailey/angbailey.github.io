---
title: "plotly"
author: "Angelica Bailey"
date: "2025-10-23"
output: html_document
---

```{r}
library(tidyverse)
library(p8105.datasets)
library(plotly)
```


```{r}
data("instacart")

instacart = instacart |> 
  sample_n(10000)

```


#Plot ideas

- Most popular aisles or departments: Bar plot showing total orders per aisle or department
- Distribution of products added to cart position: Histogram of add_to_cart_order(do users tend to add certain prodcuts earlier in their cart)
- Reorder rate by department or aisle: bar plot showing proportion of reordered items in each department
- Reorder probability by time of day: Line plot of average reordered rate vs. order_hour_of_day
- Orders by hour of day: bar plot or histogram of order_hour_of_day (when do people shop the most?)
- Orders by day of the week: Bar plot of order_dow


Bar plot showing total orders per aisle or department
```{r}
#total number of orders per aisle
dept_summary = instacart |> 
  group_by(department) |> 
  summarise(total_orders = n()) |> 
  arrange(desc(total_orders))

plot_ly(
  data = dept_summary,
  x = ~reorder(department, total_orders),
  y = ~total_orders,
  type = 'bar',
  color = ~department,
  colors = "Set1",
  text = ~paste("Orders:", total_orders),
  hoverinfo = "text",
  textposition = "none"  # hides text inside bars
) |> 
  layout(
    title = "Total Orders by Department",
    xaxis = list(title = "Department", tickangle = -45),
    yaxis = list(title = "Number of Orders"),
    showlegend = FALSE
  )

```



What are the most popular items? (Horizontal bar chart)
top 20 most frequently purchased products
```{r}
orders_by_hour = instacart |> 
  group_by(order_id) |> 
  summarise(
    #get the hour for this order (it's the same for all rows in the group)
    order_hour = first(order_hour_of_day) 
  ) |> 
  ungroup()

#count total number of orders for each hour
plot_data = orders_by_hour |> 
  count(order_hour, name = "total_orders")

#plot
plot_ly(
  data = plot_data,
  x = ~order_hour,
  y = ~total_orders,
  type = 'bar',
  color = ~order_hour,
  colors = "Set3",
  hoverinfo = 'text',
  textposition = "none",
  text = ~paste(
    "Hour:", order_hour,
    "Total Orders:", format(total_orders, big.mark = ",")
  )) |> 
  layout(
    title = "Peak Shopping Hours",
    xaxis = list(
      title = "Hour of Day (0-23)",
      type = 'category',  
      tickmode = 'linear'
    ),
    yaxis = list(
      title = "Total Number of Orders"
    )
  )
```



How do people build their carts

```{r}
plot_data <- instacart |> 
  group_by(add_to_cart_order) |> 
  summarise(
    reorder_rate = mean(reordered), 
    total_items = n() 
  ) |> 
  filter(add_to_cart_order <= 20) |> 
  ungroup()


plot_ly(
  data = plot_data,
  x = ~add_to_cart_order,
  y = ~reorder_rate,
  type = 'scatter',
  mode = 'lines+markers', # A line with markers at each data point
  hoverinfo = 'text',
  text = ~paste(
    "Cart Position:", add_to_cart_order,
    "Reorder Rate:", paste0(round(reorder_rate * 100, 1), "%"),
    "Total Items:", format(total_items, big.mark = ",")
  )) |> 
  
  layout(
    title = "Reorder Rate vs. Cart Position",
    xaxis = list(
      title = "Item Added to Cart (Order)"
    ),
    yaxis = list(
      title = "Reorder Rate (Likelihood of being a reorder)",
      tickformat = '.0%' 
    )
  )
```









